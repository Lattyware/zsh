CONFIG_PATH="${XDG_CONFIG_HOME:-${HOME}/.config}/zsh"

# Set a large history file.
HISTFILE=${CONFIG_PATH}/history
HISTSIZE=100000
SAVEHIST=100000
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY
setopt HIST_IGNORE_SPACE

# Add exports
source ${CONFIG_PATH}/exports
if [ -f ${CONFIG_PATH}/exports.local ]; then
  source ${CONFIG_PATH}/exports.local
fi

# Set up system path.
typeset -U PATH path # Discard duplicates.
path=("$path[@]")
path+=("${HOME}/.local/bin")
export PATH

# Syntax highlighting.
source "${CONFIG_PATH}/tools/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
# History searching.
source "${CONFIG_PATH}/tools/zsh-history-substring-search/zsh-history-substring-search.zsh"

# Allow extended globbing.
setopt extendedglob nomatch

source "${CONFIG_PATH}/keymap"

# Set Emacs style keys.
bindkey -e
# Ctrl+Left/Right to navigate words.
bindkey -- "${key[Control-Left]}" backward-word
bindkey -- "${key[Control-Right]}" forward-word
# Fix keys that don't work correctly.
bindkey -- "${key[Home]}" beginning-of-line
bindkey -- "${key[End]}" end-of-line
bindkey -- "${key[Delete]}" delete-char

# Prompt theming.
fpath=("${CONFIG_PATH}/fpath" "$fpath[@]")
autoload -Uz promptinit
promptinit

eval "$(starship init zsh)"

# Completion.
fpath=(${CONFIG_PATH}/tools/zsh-completions/src $fpath)
zstyle ':completion:*' menu select
zstyle ':completion:*' completer _expand _complete _ignored _correct _approximate
zstyle ':completion:*' matcher-list '' 'm:{[:lower:][:upper:]}={[:upper:][:lower:]}' 'l:|=* r:|=*'
zstyle ':completion::complete:*' gain-privileges 1
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"
setopt COMPLETE_ALIASES

autoload -Uz compinit
compinit -d "${XDG_CACHE_HOME}/zsh/zcompdump"

# Add slashes when autocompleting directories.
setopt AUTO_PARAM_SLASH
unsetopt AUTO_REMOVE_SLASH

bindkey -- "${key[Up]}" history-substring-search-up
bindkey -- "^[OA" history-substring-search-up
bindkey -- "${key[Down]}" history-substring-search-down
bindkey -- "^[OB" history-substring-search-down

# Add aliases
source ${CONFIG_PATH}/aliases
if [ -f ${CONFIG_PATH}/aliases.local ]; then
  source ${CONFIG_PATH}/aliases.local
fi

. ~/ssh-add.sh >/dev/null 2>&1

if [ -f ${CONFIG_PATH}/config.local ]; then
  source ${CONFIG_PATH}/config.local
fi

